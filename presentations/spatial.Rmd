---
title: "Spatial Data in R"
output: 
  ioslides_presentation:
    widescreen: yes

---

## Spatial data

Lots of data in our field(s) are inherently spatial

R has lots of tools for interacting with and analyzing spatial data


```{r}
```

## the `sp` package

The `sp` package is the workhorse of spatial mapping and analysis in R.

It defines spatial classes (e.g. `SpatialPoints`, `SpatialPointsDataFrame`) that make it possible to work with spatial data. 

## actual spatial data versus coordinates {.smaller .build}

We often just have coordinate data, but this works differently in R from fully spatial data

```{r eval=FALSE}
myCoords <- data.frame(long = runif(20, min=35, max=36), lat = runif(20, min = 3, max=5))
plot(myCoords)
```

```{r echo=F}
set.seed(1234)
myCoords <- data.frame(long = runif(20, min=35, max=36), lat = runif(20, min = 3, max=5))
plot(myCoords)
text(x=35.7, y=4.3, labels = "What is wrong with this plot?", col="red", cex=1.4)
```

## making spatial objects {.build .smaller}

You can use the `SpatialPoints()` function to make your coordinates into a fully spatial object

**Warning**: This function will assume that your columns are in the order: X coordinate, Y Coordinate

For a gold star: Which is the x and which is the y when we are dealing with latitude and longitude?

```{r}
library(sp)
spMyCoords <- SpatialPoints(coords = myCoords)
```

Now there are a plethora of spatial things you can do with these points that you couldn't before

```{r}
bbox(spMyCoords)
```

## making spatial objects {.build .smaller}

```{r}
plot(spMyCoords, axes=TRUE)
```

## maps {.smaller}

The `maps` package provides basic maps that can serve as a backdrop to your points

```{r}
library(maps)
world <- map(database = "world")
```

## maps {.smaller}


### This is not an accurate election map!

```{r}
USA <- map(database="state", fill=TRUE, col=c("red","blue"))
```


## maps {.smaller}

```{r}
kenya <- map(database = "world", region="Kenya")
```


## Challenge

Plot the `spCoords` points as solid blue filled circles on top of the Kenya map

## RGoogleMaps

```{r}

library("RgoogleMaps")
UNCG <- GetMap(center = c(36.0674908,-79.8098429), zoom = 17)
PlotOnStaticMap(UNCG)
```

## RGoogleMaps

```{R}
UNCGSatellite <- GetMap(center = c(36.0674908, -79.8098429), zoom = 17, maptype = "satellite")
PlotOnStaticMap(UNCGSatellite, lon=-77.0493, lat=38.899, pch=16, col="red", cex=2)
```

## Challenge

Get a satellite image of Africa, and plot a blue + symbol on Khartoum  

## GIS in R {.build}

You can do almost anything in R that you can do in ArcGIS.  

This is accomplished through additional packages, notably `rgdal` which is an R interface to the Geospatial Data Abstraction Library (GDAL), which is a great piece of open source software for spatial analysis. GDAL is the brains behind QGIS. 

The `raster` package deals with geospatial raster data, relying heavily on GDAL, as well.

The `spatstats` package implements a variety of spatial statitics. 

## `rgdal`

`rgdal` can read in most any vector data

The `readOGR()` function reads in vector data

First, download the shapefile from http://uncg.rstats.ninja/datasets/spatial/africa_simple.shp.zip.  Then uncompress the file. 

```{r message=F}
library(rgdal)
africa <- readOGR("/Users/wabarr/Dropbox/UNCG-workshop/datasets/spatial/africa_simple.shp",
                  layer="africa_simple")
```
## `rgdal` 

spatial data can be plotted with the base R `plot()` function

```{r}
plot(africa, col='maroon')
```

## `raster` package

First, download the raster from http://uncg.rstats.ninja/datasets/spatial/africa_landcover.tif

```{r message=F, cache=T}
library(raster)
landCover <- raster("/Users/wabarr/Dropbox/UNCG-workshop/datasets/spatial/africa_landcover.tif")
plot(landCover)
```

## projections

```{r}
proj4string(landCover)
proj4string(africa)
```

Notice that the africa shapefile is in a different projection (Eckert VI equal area) rather than latitude / longitude, which is the most common coordinate system you will see

## reprojecting

You can reproject vector data with `sp::spTransform()`

You can reproject raster data with `raster::projectRaster()`

## reprojecting

Let's reproject the `africa` shapefile into lat/lon coordinates

```{r}
africaLatLon <- spTransform(africa, proj4string(landCover))
```

## plot together

Now that they are in the same coordinate system we can plot them together

```{r cache=T}
plot(landCover)
plot(africaLatLon, add=T, border="purple", lwd=5)
```

## mask raster with shapefile

```{r cache=T}
maskedLandCover <- raster::mask(landCover, africaLatLon)
plot(maskedLandCover)
```

## load in some point data

```{r cache=T}
sites <- read.table("http://uncg.rstats.ninja/datasets/spatial/africanSites.txt", 
                    header=T, sep="\t")
sitesSP <- SpatialPointsDataFrame(coords=sites[,1:2], data=sites["siteID"])
plot(maskedLandCover)
plot(sitesSP, add=T, pch=16, col="blue")
```


## buffers

Make 1 degree buffers using the `rgeos:gBuffer()` function

```{r}
rgeos::gBuffer(sitesSP, byid = T, width=1)
```

